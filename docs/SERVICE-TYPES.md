# Home Service Type Conventions

This document describes conventions for creating proper Guix home service
types in this configuration.

## Structure

Each home service module should follow this pattern:

```scheme
(define-module (r0man guix home <name>)
  #:use-module (gnu home services)
  #:use-module (gnu services)
  #:use-module (guix records)
  #:use-module (guix gexp)
  #:export (home-<name>-configuration
            home-<name>-service-type))

;; Configuration record
(define-record-type* <home-<name>-configuration>
  home-<name>-configuration make-home-<name>-configuration
  home-<name>-configuration?
  (field1  home-<name>-field1 (default value1))
  (field2  home-<name>-field2 (default value2)))

;; Extension procedures
(define (home-<name>-packages config)
  "Return list of packages to install."
  (list package1 package2 ...))

(define (home-<name>-files config)
  "Return alist of (target . source) file mappings."
  `(("target/path" ,(local-file "source/path"))))

;; Service type definition
(define home-<name>-service-type
  (service-type
   (name 'home-<name>)
   (extensions
    (list (service-extension home-profile-service-type
                             home-<name>-packages)
          (service-extension home-files-service-type
                             home-<name>-files)))
   (default-value (home-<name>-configuration))
   (description "Description of the service")))
```

## Naming Conventions

- Module: `(r0man guix home <name>)`
- Configuration record: `<home-<name>-configuration>`
- Constructor: `home-<name>-configuration` (auto-generated by record)
- Predicate: `home-<name>-configuration?`
- Field accessors: `home-<name>-<field-name>`
- Service type: `home-<name>-service-type`
- Extension procedures: `home-<name>-packages`, `home-<name>-files`, etc.

## Configuration Record Guidelines

1. **Always provide defaults**: Every field should have a sensible default
2. **Use descriptive field names**: Clear about what the field controls
3. **Keep it simple**: Only add fields that users might want to customize
4. **Document with docstrings**: Add descriptions to fields

## Extension Procedures

Extension procedures take the configuration record and return the data
needed by the extended service:

- `home-<name>-packages`: Returns list of packages
- `home-<name>-files`: Returns alist of file mappings
- `home-<name>-shepherd-services`: Returns list of shepherd services
- `home-<name>-environment-variables`: Returns alist of env vars

## Usage in System Configurations

In system config files (e.g., `systems/m1.scm`):

```scheme
;; Use defaults
(service home-<name>-service-type)

;; Or customize
(service home-<name>-service-type
         (home-<name>-configuration
          (field1 custom-value1)
          (field2 custom-value2)))
```

## Migration from Service Lists

**Before:**
```scheme
(define home-<name>-services
  (list (simple-service ...)))

;; In system config
(append home-<name>-services ...)
```

**After:**
```scheme
(define home-<name>-service-type
  (service-type ...))

;; In system config
(service home-<name>-service-type)
```

## Benefits

1. **Type safety**: Configuration is validated
2. **Composability**: Services can extend each other
3. **Defaults**: Work without configuration
4. **Discoverability**: `guix home describe` shows services
5. **Guix conventions**: Follows established patterns
6. **Extensibility**: Other code can extend your services
