{"id":"guix-home-0y4","title":"Fix IBus STT engine activation timeout","description":"## Root Cause Found\n\nThe timeout occurs because the engine crashes immediately during startup due to a **Babel 2.16.0 API incompatibility**.\n\n### Error\n```python\nFile sttwordstodigits.py:98\n  self._separator_symbol=Locale(self._current_locale.locale).number_symbols['decimal']\nKeyError: 'decimal'\n```\n\n### Cause\n- ibus-speech-to-text expects: `locale.number_symbols['decimal']`\n- Babel 2.16.0 returns: `locale.number_symbols['latn']['decimal']`\n\nThe code needs to be patched to use the new Babel API.\n\n### Fix Location\nThe fix needs to be in the guix-channel package definition for ibus-speech-to-text, adding a patch for `sttwordstodigits.py` line 98.\n\n### Files\n- ibus-speech-to-text package in https://github.com/r0man/guix-channel\n- `sttwordstodigits.py:98` in upstream","status":"open","priority":2,"issue_type":"task","owner":"roman@burningswell.com","created_at":"2026-01-25T14:45:17.678666214+01:00","created_by":"Roman Scherer","updated_at":"2026-01-25T14:57:20.76262313+01:00","labels":["bug"],"dependencies":[{"issue_id":"guix-home-0y4","depends_on_id":"guix-home-7ll","type":"blocks","created_at":"2026-01-25T14:57:33.666532041+01:00","created_by":"Roman Scherer"}]}
{"id":"guix-home-1vb","title":"Create ibus.scm service module","description":"Create modules/r0man/guix/home/ibus.scm with env vars, packages, and Shepherd service","status":"closed","priority":2,"issue_type":"task","owner":"roman@burningswell.com","created_at":"2026-01-25T13:22:28.379670325+01:00","created_by":"Roman Scherer","updated_at":"2026-01-25T13:25:41.218592948+01:00","closed_at":"2026-01-25T13:25:41.218592948+01:00","close_reason":"Created ibus.scm with home-ibus-service-type providing Shepherd service, environment variables, and packages"}
{"id":"guix-home-7ll","title":"Patch ibus-speech-to-text for Babel 2.16.0 compatibility","description":"## Problem\n\nibus-speech-to-text 0.4.0 is incompatible with Babel 2.16.0.\n\n### Error\n```python\nFile sttwordstodigits.py:98\n  self._separator_symbol=Locale(self._current_locale.locale).number_symbols['decimal']\nKeyError: 'decimal'\n```\n\n### Fix Required\n\nPatch `sttwordstodigits.py` line 98:\n```python\n# Old (broken with Babel 2.16.0):\nself._separator_symbol=Locale(self._current_locale.locale).number_symbols['decimal']\n\n# New (works with Babel 2.16.0):\nself._separator_symbol=Locale(self._current_locale.locale).number_symbols['latn']['decimal']\n```\n\n### Implementation\n\n1. Create a patch file in guix-channel\n2. Add the patch to the ibus-speech-to-text package definition\n3. Rebuild and test\n\n### Repository\nhttps://github.com/r0man/guix-channel","status":"open","priority":2,"issue_type":"task","owner":"roman@burningswell.com","created_at":"2026-01-25T14:57:25.218649663+01:00","created_by":"Roman Scherer","updated_at":"2026-01-25T14:57:32.82355923+01:00"}
{"id":"guix-home-amv","title":"Add IBus service to precision.scm","description":"Import (r0man guix home ibus) and add (service home-ibus-service-type) to services","status":"closed","priority":2,"issue_type":"task","owner":"roman@burningswell.com","created_at":"2026-01-25T13:22:29.239475764+01:00","created_by":"Roman Scherer","updated_at":"2026-01-25T13:26:21.202804605+01:00","closed_at":"2026-01-25T13:26:21.202804605+01:00","close_reason":"Added home-ibus-service-type to precision.scm services list","dependencies":[{"issue_id":"guix-home-amv","depends_on_id":"guix-home-1vb","type":"blocks","created_at":"2026-01-25T13:22:38.00795729+01:00","created_by":"Roman Scherer"}]}
{"id":"guix-home-khj","title":"IBus Home Service for Guix","description":"Create Guix Home service module for IBus: sets env vars, installs packages, starts ibus-daemon via Shepherd. Files: 3 to modify.","status":"closed","priority":1,"issue_type":"epic","owner":"roman@burningswell.com","created_at":"2026-01-25T13:22:19.700763872+01:00","created_by":"Roman Scherer","updated_at":"2026-01-25T13:27:04.051901714+01:00","closed_at":"2026-01-25T13:27:04.051901714+01:00","close_reason":"IBus Home Service implemented: ibus.scm module with Shepherd service, environment variables, and packages; integrated into precision.scm","dependencies":[{"issue_id":"guix-home-khj","depends_on_id":"guix-home-1vb","type":"blocks","created_at":"2026-01-25T13:22:38.075911267+01:00","created_by":"Roman Scherer"},{"issue_id":"guix-home-khj","depends_on_id":"guix-home-amv","type":"blocks","created_at":"2026-01-25T13:22:38.113096528+01:00","created_by":"Roman Scherer"},{"issue_id":"guix-home-khj","depends_on_id":"guix-home-ybe","type":"blocks","created_at":"2026-01-25T13:22:38.151079869+01:00","created_by":"Roman Scherer"}]}
{"id":"guix-home-lbv","title":"Investigate ibus-daemon child process environment inheritance","description":"## Problem\n\nWhen ibus-daemon spawns the ibus-engine-stt process, it may not be passing all required environment variables correctly.\n\n## Background\n\nThe shepherd service sets `IBUS_COMPONENT_PATH` and `GST_PLUGIN_PATH` for the ibus-daemon process. However, when ibus-daemon spawns child processes (engines), it's unclear if these environment variables are inherited.\n\n## Current Setup\n\nShepherd service passes environment via `fork+exec-command`:\n```scheme\n#:environment-variables\n(cons* (string-append \"IBUS_COMPONENT_PATH=\" component-path)\n       (string-append \"GST_PLUGIN_PATH=\" gst-plugin-path)\n       ...)\n```\n\n## Investigation Needed\n\n1. Check if ibus-daemon uses D-Bus activation or direct exec for engines\n2. Verify environment variables are passed to child processes\n3. If D-Bus activation is used, environment may need to be set differently\n4. Consider wrapper script approach if needed\n\n## Verification\n\nWhen engine is started manually with correct environment, it works:\n```bash\nGST_PLUGIN_PATH=~/.guix-home/profile/lib/gstreamer-1.0 \\\nIBUS_COMPONENT_PATH=~/.guix-home/profile/share/ibus/component \\\nibus-engine-stt --ibus --debug\n```\n\n## Files\n\n- `/home/r0man/workspace/guix-home/modules/r0man/guix/home/ibus.scm`\n- `/home/r0man/.guix-home/profile/share/ibus/component/stt.xml`","status":"closed","priority":2,"issue_type":"task","owner":"roman@burningswell.com","created_at":"2026-01-25T14:45:26.862026589+01:00","created_by":"Roman Scherer","updated_at":"2026-01-25T14:57:12.008301517+01:00","closed_at":"2026-01-25T14:57:12.008301517+01:00","close_reason":"Investigation complete: Environment variables ARE correctly inherited. The actual issue is a Babel 2.16.0 API incompatibility in ibus-speech-to-text. The code expects locale.number_symbols['decimal'] but Babel 2.16.0 returns locale.number_symbols['latn']['decimal']. This is a bug in the ibus-speech-to-text package, not an environment issue.","labels":["investigation"]}
{"id":"guix-home-nw8","title":"Create wrapper script for ibus-engine-stt with environment","description":"## Proposal\n\nCreate a wrapper script that sets required environment variables before launching ibus-engine-stt. Modify the IBus component XML to use this wrapper instead of directly calling the engine binary.\n\n## Rationale\n\nIf ibus-daemon doesn't properly inherit environment variables to child processes, a wrapper script can ensure the engine always starts with correct environment.\n\n## Implementation\n\n1. Create wrapper script in guix home files:\n```bash\n#!/bin/sh\nexport GST_PLUGIN_PATH=\"$HOME/.guix-home/profile/lib/gstreamer-1.0\"\nexport IBUS_COMPONENT_PATH=\"$HOME/.guix-home/profile/share/ibus/component\"\nexec /path/to/ibus-engine-stt \"$@\"\n```\n\n2. Create custom component XML that points to wrapper\n3. Set IBUS_COMPONENT_PATH to custom location with modified XML\n\n## Alternative\n\nPatch ibus-speech-to-text package to include environment setup in the engine itself.\n\n## Depends On\n\n- guix-home-lbv (Investigate environment inheritance)\n\n## Files\n\n- `/home/r0man/workspace/guix-home/modules/r0man/guix/home/ibus.scm`","status":"closed","priority":2,"issue_type":"task","owner":"roman@burningswell.com","created_at":"2026-01-25T14:45:34.481105538+01:00","created_by":"Roman Scherer","updated_at":"2026-01-25T14:57:45.207856639+01:00","closed_at":"2026-01-25T14:57:45.207856639+01:00","close_reason":"Not needed. Investigation (guix-home-lbv) found environment variables ARE correctly inherited. The actual problem is a Babel 2.16.0 API incompatibility in ibus-speech-to-text, which requires a code patch (guix-home-7ll), not a wrapper script.","labels":["enhancement"],"dependencies":[{"issue_id":"guix-home-nw8","depends_on_id":"guix-home-lbv","type":"blocks","created_at":"2026-01-25T14:45:43.875512531+01:00","created_by":"Roman Scherer"}]}
{"id":"guix-home-ybe","title":"Remove IBus packages from packages.scm","description":"Remove ibus and ibus-speech-to-text from packages-base (now managed by service)","status":"closed","priority":2,"issue_type":"task","owner":"roman@burningswell.com","created_at":"2026-01-25T13:22:30.250003347+01:00","created_by":"Roman Scherer","updated_at":"2026-01-25T13:26:56.174645734+01:00","closed_at":"2026-01-25T13:26:56.174645734+01:00","close_reason":"Removed ibus and ibus-speech-to-text from packages-base since they are now provided by home-ibus-service-type","dependencies":[{"issue_id":"guix-home-ybe","depends_on_id":"guix-home-amv","type":"blocks","created_at":"2026-01-25T13:22:38.041217095+01:00","created_by":"Roman Scherer"}]}
