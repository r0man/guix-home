{"id":"guix-home-0y4","title":"Fix IBus STT engine activation timeout","description":"## Problem\n\nThe `ibus engine stt` command times out after 25 seconds when trying to activate the Speech-to-Text engine.\n\n## Current Behavior\n\n- Engine shows in `ibus list-engine` output\n- When started manually with correct environment, engine initializes and loads Vosk model successfully\n- When ibus-daemon tries to spawn the engine, it times out before completing initialization\n\n## Error Message\n\n```\nIBUS-WARNING: ibus_bus_call_sync: org.freedesktop.IBus.SetGlobalEngine: \nGDBus.Error:org.freedesktop.DBus.Error.Failed: Set global engine failed: Timeout was reached\n```\n\n## Debug Output (when engine works manually)\n\n```\nDEBUG: sttvoskmodel.py:70:_set_model: new model (/home/r0man/.cache/vosk/vosk-model-small-en-us-0.15, ...)\nDEBUG: sttgstvosk.py:110:_set_model_path: model ready /home/r0man/.cache/vosk/vosk-model-small-en-us-0.15\nINFO: sttengine.py:293:do_enable: engine enabled (active_on_start=False)\n```\n\n## Possible Causes\n\n1. Vosk model loading takes too long (model is 40MB)\n2. D-Bus timeout too short for speech recognition initialization\n3. Environment variables not properly inherited by spawned engine process\n4. GStreamer pipeline initialization delay\n\n## Workaround\n\nUse ibus-setup GUI to add and activate the STT input method instead of command line.\n\n## Files\n\n- `/home/r0man/workspace/guix-home/modules/r0man/guix/home/ibus.scm`","status":"open","priority":2,"issue_type":"task","owner":"roman@burningswell.com","created_at":"2026-01-25T14:45:17.678666214+01:00","created_by":"Roman Scherer","updated_at":"2026-01-25T14:45:17.678666214+01:00","labels":["bug"]}
{"id":"guix-home-1vb","title":"Create ibus.scm service module","description":"Create modules/r0man/guix/home/ibus.scm with env vars, packages, and Shepherd service","status":"closed","priority":2,"issue_type":"task","owner":"roman@burningswell.com","created_at":"2026-01-25T13:22:28.379670325+01:00","created_by":"Roman Scherer","updated_at":"2026-01-25T13:25:41.218592948+01:00","closed_at":"2026-01-25T13:25:41.218592948+01:00","close_reason":"Created ibus.scm with home-ibus-service-type providing Shepherd service, environment variables, and packages"}
{"id":"guix-home-amv","title":"Add IBus service to precision.scm","description":"Import (r0man guix home ibus) and add (service home-ibus-service-type) to services","status":"closed","priority":2,"issue_type":"task","owner":"roman@burningswell.com","created_at":"2026-01-25T13:22:29.239475764+01:00","created_by":"Roman Scherer","updated_at":"2026-01-25T13:26:21.202804605+01:00","closed_at":"2026-01-25T13:26:21.202804605+01:00","close_reason":"Added home-ibus-service-type to precision.scm services list","dependencies":[{"issue_id":"guix-home-amv","depends_on_id":"guix-home-1vb","type":"blocks","created_at":"2026-01-25T13:22:38.00795729+01:00","created_by":"Roman Scherer"}]}
{"id":"guix-home-khj","title":"IBus Home Service for Guix","description":"Create Guix Home service module for IBus: sets env vars, installs packages, starts ibus-daemon via Shepherd. Files: 3 to modify.","status":"closed","priority":1,"issue_type":"epic","owner":"roman@burningswell.com","created_at":"2026-01-25T13:22:19.700763872+01:00","created_by":"Roman Scherer","updated_at":"2026-01-25T13:27:04.051901714+01:00","closed_at":"2026-01-25T13:27:04.051901714+01:00","close_reason":"IBus Home Service implemented: ibus.scm module with Shepherd service, environment variables, and packages; integrated into precision.scm","dependencies":[{"issue_id":"guix-home-khj","depends_on_id":"guix-home-1vb","type":"blocks","created_at":"2026-01-25T13:22:38.075911267+01:00","created_by":"Roman Scherer"},{"issue_id":"guix-home-khj","depends_on_id":"guix-home-amv","type":"blocks","created_at":"2026-01-25T13:22:38.113096528+01:00","created_by":"Roman Scherer"},{"issue_id":"guix-home-khj","depends_on_id":"guix-home-ybe","type":"blocks","created_at":"2026-01-25T13:22:38.151079869+01:00","created_by":"Roman Scherer"}]}
{"id":"guix-home-lbv","title":"Investigate ibus-daemon child process environment inheritance","description":"## Problem\n\nWhen ibus-daemon spawns the ibus-engine-stt process, it may not be passing all required environment variables correctly.\n\n## Background\n\nThe shepherd service sets `IBUS_COMPONENT_PATH` and `GST_PLUGIN_PATH` for the ibus-daemon process. However, when ibus-daemon spawns child processes (engines), it's unclear if these environment variables are inherited.\n\n## Current Setup\n\nShepherd service passes environment via `fork+exec-command`:\n```scheme\n#:environment-variables\n(cons* (string-append \"IBUS_COMPONENT_PATH=\" component-path)\n       (string-append \"GST_PLUGIN_PATH=\" gst-plugin-path)\n       ...)\n```\n\n## Investigation Needed\n\n1. Check if ibus-daemon uses D-Bus activation or direct exec for engines\n2. Verify environment variables are passed to child processes\n3. If D-Bus activation is used, environment may need to be set differently\n4. Consider wrapper script approach if needed\n\n## Verification\n\nWhen engine is started manually with correct environment, it works:\n```bash\nGST_PLUGIN_PATH=~/.guix-home/profile/lib/gstreamer-1.0 \\\nIBUS_COMPONENT_PATH=~/.guix-home/profile/share/ibus/component \\\nibus-engine-stt --ibus --debug\n```\n\n## Files\n\n- `/home/r0man/workspace/guix-home/modules/r0man/guix/home/ibus.scm`\n- `/home/r0man/.guix-home/profile/share/ibus/component/stt.xml`","status":"open","priority":2,"issue_type":"task","owner":"roman@burningswell.com","created_at":"2026-01-25T14:45:26.862026589+01:00","created_by":"Roman Scherer","updated_at":"2026-01-25T14:45:26.862026589+01:00","labels":["investigation"]}
{"id":"guix-home-nw8","title":"Create wrapper script for ibus-engine-stt with environment","description":"## Proposal\n\nCreate a wrapper script that sets required environment variables before launching ibus-engine-stt. Modify the IBus component XML to use this wrapper instead of directly calling the engine binary.\n\n## Rationale\n\nIf ibus-daemon doesn't properly inherit environment variables to child processes, a wrapper script can ensure the engine always starts with correct environment.\n\n## Implementation\n\n1. Create wrapper script in guix home files:\n```bash\n#!/bin/sh\nexport GST_PLUGIN_PATH=\"$HOME/.guix-home/profile/lib/gstreamer-1.0\"\nexport IBUS_COMPONENT_PATH=\"$HOME/.guix-home/profile/share/ibus/component\"\nexec /path/to/ibus-engine-stt \"$@\"\n```\n\n2. Create custom component XML that points to wrapper\n3. Set IBUS_COMPONENT_PATH to custom location with modified XML\n\n## Alternative\n\nPatch ibus-speech-to-text package to include environment setup in the engine itself.\n\n## Depends On\n\n- guix-home-lbv (Investigate environment inheritance)\n\n## Files\n\n- `/home/r0man/workspace/guix-home/modules/r0man/guix/home/ibus.scm`","status":"open","priority":2,"issue_type":"task","owner":"roman@burningswell.com","created_at":"2026-01-25T14:45:34.481105538+01:00","created_by":"Roman Scherer","updated_at":"2026-01-25T14:45:34.481105538+01:00","labels":["enhancement"],"dependencies":[{"issue_id":"guix-home-nw8","depends_on_id":"guix-home-lbv","type":"blocks","created_at":"2026-01-25T14:45:43.875512531+01:00","created_by":"Roman Scherer"}]}
{"id":"guix-home-ybe","title":"Remove IBus packages from packages.scm","description":"Remove ibus and ibus-speech-to-text from packages-base (now managed by service)","status":"closed","priority":2,"issue_type":"task","owner":"roman@burningswell.com","created_at":"2026-01-25T13:22:30.250003347+01:00","created_by":"Roman Scherer","updated_at":"2026-01-25T13:26:56.174645734+01:00","closed_at":"2026-01-25T13:26:56.174645734+01:00","close_reason":"Removed ibus and ibus-speech-to-text from packages-base since they are now provided by home-ibus-service-type","dependencies":[{"issue_id":"guix-home-ybe","depends_on_id":"guix-home-amv","type":"blocks","created_at":"2026-01-25T13:22:38.041217095+01:00","created_by":"Roman Scherer"}]}
